<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Scavenger Hunt Intro</title>
<style>
  body {
    background-color: #1a1a1a;
    color: #00ffcc;
    font-family: monospace;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    padding: 20px;
    margin: 0;
  }
  #narration {
    max-width: 800px;
    white-space: pre-wrap;
    font-size: 1.2rem;
    line-height: 1.5;
    margin-top: 20px;
    opacity: 0;
    transition: opacity 1s ease;
    text-align: center;
  }
  #startBtn {
    padding: 10px 20px;
    font-size: 1rem;
    cursor: pointer;
    border: none;
    border-radius: 5px;
    background-color: #00cc88;
    color: black;
  }
canvas {
    background: url('Images/background.jpg') no-repeat center center;
    background-size: cover; /* or 'contain' for full visibility */
}

</style>
</head>
<body>

<button id="startBtn">Start Adventure</button>
<canvas id="gameCanvas" width="320" height="160"></canvas>
<div id="narration"></div>

<script>
  const scriptText = `Welcome to the adventure, time traveller. You will journey through 21st-century London as it existed over 4000 years ago. To avoid detection, you must dress, act, and behave like someone of this time. I've implanted your mission brief into your neuronic chip — plus a translator to convert native ÆEalt into primitive English. Your mission: follow the footsteps of your target Joel Jack on Thursday the 14th of August 2025 and assume the identity of his girlfriend, Jadine Downes. Use the clues around London to find and locate him. Be advised, he is quite dangerous and has incredible charm and wit. Use all you can to resist his irresistible good looks and capture him safely for the mission. He holds the key to the fate of the universe. Good luck and safe travels.`;

  const sentences = scriptText.split('. ').map(s => s.trim()).filter(Boolean).map(s => s.endsWith('.') ? s : s + '.');

  const narrationElement = document.getElementById("narration");
  const startBtn = document.getElementById("startBtn");
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");

  const voice = new Audio("audio/voice.mp3");
const bgmusic = new Audio("audio/bgmusic.mp3");

bgmusic.loop = true;
bgmusic.volume = 0.4;

  bgmusic.loop = true;
  bgmusic.volume = 0.4;

  // Sprite settings
  const SPRITE_SIZE = 64;
  let posX = -SPRITE_SIZE;
  let frame = 0;
  let animState = 'walking';

  const spriteSheet = new Image();
  spriteSheet.src = 'Images/ girl-sprite.png'; // Update to your sprite path

  spriteSheet.onerror = () => {
    console.error('Failed to load sprite sheet image.');
  };
  voice.onerror = () => {
    console.error('Failed to load voice audio.');
  };
  bgMusic.onerror = () => {
    console.error('Failed to load background music audio.');
  };

  function drawSprite(x, y, frameIndex, action) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const frameWidth = SPRITE_SIZE;
    const frameHeight = SPRITE_SIZE;
    let spriteRow = 0;

 

    let frameToDraw = 0;
 

    ctx.drawImage(
      spriteSheet,
      frameToDraw * frameWidth,
      spriteRow * frameHeight,
      frameWidth,
      frameHeight,
      x,
      y,
      SPRITE_SIZE,
      SPRITE_SIZE
    );
  }

  function animateSprite() {
    if (animState === 'walking') {
      drawSprite(posX, 100, frame, 'walking');
      posX += 2;
      if (posX >= canvas.width / 2 - SPRITE_SIZE / 2) {
        animState = 'opening';
        setTimeout(() => {
          animState = 'done';
        }, 1000);
      }
    } else {
      drawSprite(posX, 100, frame, animState);
    }
    frame = (frame + 1) % 3; // cycle walking frames
    requestAnimationFrame(animateSprite);
  }

  function fadeIn(element, duration = 1000) {
    element.style.transition = `opacity ${duration}ms ease`;
    element.style.opacity = 1;
  }
  function fadeOut(element, duration = 1000) {
    element.style.transition = `opacity ${duration}ms ease`;
    element.style.opacity = 0;
  }

  let currentSentence = 0;
  function showSentence() {
    if (currentSentence >= sentences.length) {
      fadeOut(narrationElement, 1000);
      fadeInBgMusic();
      return;
    }
    narrationElement.textContent = sentences[currentSentence];
    fadeIn(narrationElement, 1000);
    setTimeout(() => {
      fadeOut(narrationElement, 1000);
      setTimeout(() => {
        currentSentence++;
        showSentence();
      }, 1000);
    }, 4000);
  }

  function fadeInBgMusic() {
    bgMusic.play();
    let vol = 0;
    const interval = setInterval(() => {
      if (vol < 0.5) {
        vol += 0.01;
        bgMusic.volume = vol;
      } else {
        clearInterval(interval);
      }
    }, 100);
  }

  startBtn.addEventListener("click", () => {
    startBtn.style.display = 'none';
    console.log("Start clicked, loading sprite...");
    spriteSheet.onload = () => {
      console.log("Sprite loaded.");
      voice.play()
        .then(() => {
          console.log("Voice playing.");
          showSentence();
          animateSprite();
        })
        .catch(err => {
          console.error("Audio play prevented:", err);
          startBtn.style.display = 'inline-block';
        });
    };
    if (spriteSheet.complete) {
      spriteSheet.onload();
    }
  });
</script>

</body>
</html>
