<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Scavenger Hunt Intro - Sprite Test</title>
<style>
  body {
    background-color: #1a1a1a;
    color: #00ffcc;
    font-family: monospace;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    padding: 20px;
    margin: 0;
  }
  #narration {
    max-width: 800px;
    white-space: pre-wrap;
    font-size: 1.2rem;
    line-height: 1.5;
    margin-top: 20px;
    opacity: 0;
    transition: opacity 1s ease;
    text-align: center;
  }
  #startBtn {
    padding: 10px 20px;
    font-size: 1rem;
    cursor: pointer;
    border: none;
    border-radius: 5px;
    background-color: #00cc88;
    color: black;
  }
  canvas {
    background: #2c6d1e; /* grass green */
    border: 4px solid #004400;
    image-rendering: pixelated;
    margin-top: 20px;
  }
</style>
</head>
<body>

<button id="startBtn">Start Adventure</button>
<canvas id="gameCanvas" width="320" height="160"></canvas>
<div id="narration"></div>

<script>
  const narrationElement = document.getElementById("narration");
  const startBtn = document.getElementById("startBtn");
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");

  const SPRITE_SIZE = 64;
  let posX = -SPRITE_SIZE;
  let frame = 0;
  let animState = 'walking';

  // Load sprite sheet image
  const spriteSheet = new Image();
  spriteSheet.src = 'images/girl-sprite.png'; // <-- UPDATE to your sprite path

  spriteSheet.onload = () => {
    console.log('Sprite sheet loaded successfully.');
  };

  spriteSheet.onerror = () => {
    console.error('Failed to load sprite sheet image.');
  };

  // Simple sprite drawing function assuming:
  // - sprite sheet is 3 columns x 3 rows (walking, opening, done rows)
  // - each frame is 64x64
  function drawSprite(x, y, frameIndex, action) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (!spriteSheet.complete || spriteSheet.naturalWidth === 0) {
      // Image not loaded: draw placeholder box
      ctx.fillStyle = 'magenta';
      ctx.fillRect(x, y, SPRITE_SIZE, SPRITE_SIZE);
      ctx.fillStyle = 'white';
      ctx.font = '14px monospace';
      ctx.fillText('No Img', x + 5, y + SPRITE_SIZE / 2);
      return;
    }

    const frameWidth = SPRITE_SIZE;
    const frameHeight = SPRITE_SIZE;
    let spriteRow = 0;

    if (action === 'walking') spriteRow = 0;
    else if (action === 'opening') spriteRow = 1;
    else if (action === 'done') spriteRow = 2;

    let frameToDraw = 0;
    if (action === 'walking') {
      frameToDraw = frameIndex % 3; // cycle through 3 walking frames
    }

    ctx.drawImage(
      spriteSheet,
      frameToDraw * frameWidth,    // source x
      spriteRow * frameHeight,     // source y
      frameWidth,                  // source width
      frameHeight,                 // source height
      x,                          // destination x
      y,                          // destination y
      SPRITE_SIZE,                 // destination width
      SPRITE_SIZE                  // destination height
    );
  }

  function animateSprite() {
    if (animState === 'walking') {
      drawSprite(posX, 50, frame, 'walking'); // y=50 to center vertically in canvas 160px tall
      posX += 2;
      if (posX >= canvas.width / 2 - SPRITE_SIZE / 2) {
        animState = 'opening';
        setTimeout(() => {
          animState = 'done';
        }, 1000);
      }
    } else {
      drawSprite(posX, 50, frame, animState);
    }
    frame = (frame + 1) % 3;
    requestAnimationFrame(animateSprite);
  }

  startBtn.addEventListener("click", () => {
    startBtn.style.display = 'none';
    console.log("Start clicked.");
    if (!spriteSheet.complete) {
      spriteSheet.onload = () => {
        console.log("Sprite loaded inside start click.");
        animateSprite();
      }
    } else {
      animateSprite();
    }
  });
</script>

</body>
</html>
